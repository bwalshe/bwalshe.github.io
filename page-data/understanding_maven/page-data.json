{"componentChunkName":"component---src-templates-blog-post-js","path":"/understanding_maven/","result":{"data":{"markdownRemark":{"html":"<p>No one ever chooses to start working with Apache Maven - it's one of those things you get stuck with because of factors outside your control. I think Maven is probably one of the most frustrating aspects for people moving over to the Java world - the errors are cryptic, the documentation is dry, and the whole thing just seems way more complicated than it should be. I think part of the problem is that most people's first encounter with Maven is when they start working on an existing project, with an existing Maven config that has lots of moving parts. It's a lot to take in at once. In this post I'm going to try and keep it simple. I'll give a bit of background on Maven and talk about the absolute minimum Maven project you could create.</p>\n<h2>Why is Maven so complicated?</h2>\n<p>If you come from a Python background, turning java code into a running application can seem a lot more effort than it needs to be. Part of this is because Java makes fewer assumptions about the environment it is going to run in - this means that you need to supply this information when building the the app. </p>\n<p>Maven was created as a way of simplifying and standardising the way that this build information is specified. The most obvious benefit it provides is package management - automatically pulling the libraries you need from the web - but that is only part of what it does. Maven provides a very flexible way of packaging code up so it can be used elsewhere. It can be used to build desktop applications, components that run as part of a web-service, android applications, and all sorts of other forms of applications. It can be used to compile Scala, Clojure, different versions of java than the one running. It can run your unit tests and deploy your artefacts to remote locations.</p>\n<p>Maven achieves this flexibility by having most components implemented as plugins. When you configure it you specify which plugins to use and how each of <em>those</em> plugins are configured in turn. The two main plugins you will encounter are the <strong>compiler</strong> plugin and the <strong>surefire</strong> - the unit-test plugin. You might also have to deal with the <strong>resources</strong> plugin if your application or tests use data files, and some variant of packaging plugin if you are creating fat jars, executable jars or even fat executable jars.</p>\n<h2>Configuring a Maven Project</h2>\n<p>Maven is configured using a file called <code class=\"language-text\">pom.xml</code>. When you run the <code class=\"language-text\">mvn</code> command, it will automatically load this file and use it. For full details of the contents of <code class=\"language-text\">pom.xml</code> please see <a href=\"http://maven.apache.org/pom.html\">this document</a>. It's well worth the read and contains exciting words like \"Jarmageddon\".</p>\n<h3>Minimum Config</h3>\n<p>According to the link above, the the absolute minimum you can have in your <code class=\"language-text\">pom.xml</code> is:</p>\n<ul>\n<li><code class=\"language-text\">modelVersion</code> - This specifies the type of POM you are using, it <strong>has</strong> to be <code class=\"language-text\">4.0.0</code>. Don't confuse this with the version of your project.</li>\n<li><code class=\"language-text\">groupId</code> - Some unique group that this project belongs to. This doesn't have to have any relationship to your java packages (it doesn't even need to be dot notation) but it helps if they are similar.</li>\n<li><code class=\"language-text\">artifactId</code>- The name of your project.</li>\n<li><code class=\"language-text\">version</code> - The version number of your project.</li>\n</ul>\n<p>The <code class=\"language-text\">groupId</code>, <code class=\"language-text\">artifactId</code>, <code class=\"language-text\">version</code> values are referred to as the Maven Coordinates of the project. They are the values that people will use to locate your project if you release it into the wild - they're like latitude and longitude for software components.</p>\n<p>Here is a complete, minimal <code class=\"language-text\">pom.xml</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0\n                        http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span>\n    \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.github.bwalshe<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mini-project<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>It's pretty useless, but you could actually get this to package up a project, provided you have no dependencies and you are OK with the default settings for all of your Maven plugins.</p>\n<h2>Packaging a project</h2>\n<p>For a laugh, let's try using the minimal config to package up a very simple project. By default, Maven's compiler plugin will expect your source files to be under <code class=\"language-text\">src/main/java</code> and your test files to be under <code class=\"language-text\">src/test/java</code> - which is pretty reasonable. It's also going to expect them to be Java 5 - which is pretty unreasonable. If there are no issues with the compilation, the build process moves on to the test phase which is handled by the Surefire plugin.</p>\n<p>Surefire is going to run every function that starts with the word \"test\", in any class in the test directory that contains the word \"Test\", and will stop the build process if any of these functions throw an exception. If there are no issues with the tests then the Jar plugin will package all of the classes in the main directory into a <code class=\"language-text\">.jar</code> file.</p>\n<p>OK, set your files up with the following structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── pom.xml\n└── src\n    ├── main\n    |   └── java\n    |       └── HelloWorld.java\n    └── test\n        └── java\n            └── DummyTest.java</code></pre></div>\n<p>In the file <code class=\"language-text\">HelloWorld.java</code> paste the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloWorld</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the file <code class=\"language-text\">DummyTest.java</code>, copy in the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DummyTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This test does nothing.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testTwo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This test also does nothing.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let's run it...</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brian@DESKTOP:~/maven_mini_example$ mvn package\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>I actually got an error here. I have OpenJDK 11 on my system, and that won't compile anything earlier than Java 6. Maven's default is to compile Java 5, so they're not going to work together. The correct thing would be to set the Java version on the Maven compiler plugin, but I don't want to touch that just now, so let's just use OpenJDK 8 temporarily.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brian@DESKTOP:~/maven_mini_example$ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ mvn package\n[INFO] Scanning for projects...\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] Building mini-example 1.0\n[INFO] ------------------------------------------------------------------------\n[INFO]\n...\n...\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning DummyTest \nThis test does nothing. \nThis test also does nothing. \nTests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec \n\nResults :\n\nTests run: 2, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO]\n[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ mini-example ---\n[INFO] Building jar: /home/brian/maven_mini_example/target/mini-example-1.0.jar \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 2.523 s\n[INFO] Finished at: 2020-04-15T22:39:32+01:00\n[INFO] Final Memory: 17M/304M\n[INFO] ------------------------------------------------------------------------</code></pre></div>\n<p>That was pretty verbose (I left out a few of the more boring lines) but you can see that after compiling everything, it ran both of our tests which just printed some text to the console. They didn't really test anything, but they didn't throw any exceptions - so as far as the Surefire plugin is concerned, they were fine.</p>\n<p>After running the tests without any failures, you can see that a file named <code class=\"language-text\">mini-example-1.0.jar</code> was produced in the <code class=\"language-text\">target</code> directory. Note that the name of the jar file is a combination of the <code class=\"language-text\">artifactId</code> and <code class=\"language-text\">version</code> values we set in the POM. </p>\n<p>Let's see what the jar contains...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brian@DESKTOP:~/maven_mini_example$ jar tf target/mini-example-1.0.jar\nMETA-INF/\nMETA-INF/MANIFEST.MF\nHelloWorld.class\nMETA-INF/maven/\nMETA-INF/maven/org.codehaus.mojo/\nMETA-INF/maven/org.codehaus.mojo/mini-example/\nMETA-INF/maven/org.codehaus.mojo/mini-example/pom.xml\nMETA-INF/maven/org.codehaus.mojo/mini-example/pom.properties</code></pre></div>\n<p>There are a lot of extra files in there, but among them you should be able to see <code class=\"language-text\">HelloWorld.class</code>. We can run it from the jar</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brian@DESKTOP:~/maven_mini_example$ java -cp target/mini-example-1.0.jar HelloWorld\nHello World!</code></pre></div>\n<p>We could have also just run the tests or run the <code class=\"language-text\">HelloWorld</code> class directly using Maven without having to package it, but this is something I will have to cover in another article.</p>\n<h2>Summary</h2>\n<p>The only information that you <strong>have</strong> to give to Maven is the <code class=\"language-text\">groupId</code>, <code class=\"language-text\">artifactId</code> and <code class=\"language-text\">version</code> of your project. Everything else needed to package up a project has a default value, but it's almost certain that you will want to change those defaults. You will at least want to change the Java standard being used, and probably add some dependencies. (I didn't do that in this article.)</p>\n<p>When you package a project, by default Maven goes through several phases. These include:</p>\n<ul>\n<li>Compiling the source code</li>\n<li>Running the test cases</li>\n<li>Packaging the classes into a jar</li>\n</ul>\n<p>If any of the phases fails then the build process stops. Also, you don't have to run all the phases, you could just compile or run the tests.</p>","frontmatter":{"title":"Minimum Maven"}}},"pageContext":{"slug":"/understanding_maven/"}}}